
_G.basicshop = {
	[1] = {
		name = "pets",
		[1] = {name = "pet_change", price = {don = 500}, image = "images/custom_game/RDAShop/items/pet_change.png", rarity = "#fa3535", text_color = "white", type = "pet_change", tooltip = "shop_image_pet_change_tooltip"},
		[2] = {name = "ratingpoints_1", price = {rp = 250}, itemname = "spell_item_pet_RDA_simple_1", rarity = "#00ff48", text_color = "#00ff48", type = "pet", currency = "mmrpoints", tier = 1},
		[3] = {name = "ratingpoints_2", price = {rp = 350}, itemname = "spell_item_pet_RDA_simple_2", rarity = "#00ff48", text_color = "#00ff48", type = "pet", currency = "mmrpoints", tier = 1},
		[4] = {name = "ratingpoints_3", price = {rp = 450}, itemname = "spell_item_pet_RDA_simple_3", rarity = "#00ff48", text_color = "#00ff48", type = "pet", currency = "mmrpoints", tier = 1},
		[5] = {name = "pet_15", price = {don = 50}, itemname = "spell_item_pet_RDA_mana_regen", rarity = "#0044ff", text_color = "#0044ff", type = "pet", tier = 2},
		[6] = {name = "pet_13", price = {don = 50}, itemname = "spell_item_pet_RDA_hp_com", rarity = "#0044ff", text_color = "#0044ff", type = "pet", tier = 2},
		[7] = {name = "pet_14", price = {don = 50}, itemname = "spell_item_pet_RDA_dmg_com", rarity = "#0044ff", text_color = "#0044ff", type = "pet", tier = 2},
		[8] = {name = "pet_5", price = {don = 100}, itemname = "spell_item_pet_RDA_total_dmg", rarity = "#ffa600", text_color = "#ffa600", type = "pet", tier = 3},
		[9] = {name = "pet_6", price = {don = 100}, itemname = "spell_item_pet_RDA_int", rarity = "#ffa600", text_color = "#ffa600", type = "pet", tier = 3},
		[10] = {name = "pet_7", price = {don = 100}, itemname = "spell_item_pet_RDA_str", rarity = "#ffa600", text_color = "#ffa600", type = "pet", tier = 3},
		[11] = {name = "pet_8", price = {don = 100}, itemname = "spell_item_pet_RDA_agi", rarity = "#ffa600", text_color = "#ffa600", type = "pet", tier = 3},
		[12] = {name = "pet_9", price = {don = 100}, itemname = "spell_item_pet_RDA_heal", rarity = "#ffa600", text_color = "#ffa600", type = "pet", tier = 3},
		[13] = {name = "pet_1", price = {don = 150}, itemname = "spell_item_pet_RDA_dmg", rarity = "#d400ff", text_color = "#d400ff", type = "pet", tier = 4},
		[14] = {name = "pet_2", price = {don = 150}, itemname = "spell_item_pet_RDA_hp", rarity = "#d400ff", text_color = "#d400ff", type = "pet", tier = 4},
		[15] = {name = "pet_3", price = {don = 150}, itemname = "spell_item_pet_RDA_fast", rarity = "#d400ff", text_color = "#d400ff", type = "pet", tier = 4},
		[16] = {name = "pet_4", price = {don = 150}, itemname = "spell_item_pet_RDA_cleave", rarity = "#d400ff", text_color = "#d400ff", type = "pet", tier = 4},
		[17] = {name = "pet_10", price = {don = 150}, itemname = "spell_item_pet_RDA_block", rarity = "#d400ff", text_color = "#d400ff", type = "pet", tier = 4},
		[18] = {name = "pet_11", price = {don = 150}, itemname = "spell_item_pet_RDA_all_dmg_amp", rarity = "#d400ff", text_color = "#d400ff", type = "pet", tier = 4},
		[19] = {name = "pet_12", price = {don = 150}, itemname = "spell_item_pet_RDA_gold", rarity = "#d400ff", text_color = "#d400ff", type = "pet", tier = 4},
		[20] = {name = "pet_16", price = {don = 250}, itemname = "spell_item_pet_RDA_250_gold_and_exp", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[21] = {name = "pet_17", price = {don = 250}, itemname = "spell_item_pet_RDA_250_attribute_bonus", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[22] = {name = "pet_18", price = {don = 250}, itemname = "spell_item_pet_RDA_250_dmg_reduction", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[23] = {name = "pet_19", price = {don = 250}, itemname = "spell_item_pet_RDA_250_regen", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[24] = {name = "pet_20", price = {don = 250}, itemname = "spell_item_pet_RDA_250_bkb", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[25] = {name = "pet_21", price = {don = 250}, itemname = "spell_item_pet_RDA_250_phys_dmg_reducrion", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[26] = {name = "pet_22", price = {don = 250}, itemname = "spell_item_pet_RDA_250_pure_damage", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[27] = {name = "pet_23", price = {don = 250}, itemname = "spell_item_pet_RDA_250_no_spell_phys_bonus", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[28] = {name = "pet_24", price = {don = 250}, itemname = "spell_item_pet_RDA_250_no_phys_spell_bonus", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[29] = {name = "pet_25", price = {don = 250}, itemname = "spell_item_pet_RDA_250_minus_armor", rarity = "#fa3535", text_color = "#fa3535", type = "pet", tier = 5},
		[30] = {name = "feed_x230", price = {don = 3, rp = 15}, image = "images/custom_game/pet/shop_feed.png", give = 230, rarity = "#fa3535", text_color = "#fa3535", type ="feed", combinable = true, tooltip = "feed_x230_tooltip"},
		[31] = {name = "feed_x600", price = {don = 7, rp = 35}, image = "images/custom_game/pet/shop_feed.png", give = 600, rarity = "#fa3535", text_color = "#fa3535", type ="feed", combinable = true, tooltip = "feed_x600_tooltip"},
	},
	[2] = {
		name = "consumables",
		[1] = {name = "scroll_1", price = {don = 5}, itemname = "item_armor_aura", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[2] = {name = "scroll_2", price = {don = 5}, itemname = "item_base_damage_aura", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[3] = {name = "scroll_3", price = {don = 5}, itemname = "item_expiriance_aura", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[4] = {name = "scroll_4", price = {don = 5}, itemname = "item_move_aura", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[5] = {name = "scroll_5", price = {don = 5}, itemname = "item_attack_speed_aura", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[6] = {name = "scroll_6", price = {don = 5}, itemname = "item_hp_aura", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[7] = {name = "scroll_11", price = {don = 2}, itemname = "item_ticket", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[8] = {name = "scroll_12", price = {don = 10}, itemname = "item_boss_summon", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
		[9] = {name = "other_1", price = {don = 5}, itemname = "item_str", rarity = "red", layout = "RDAShopItem1"},
		[10] = {name = "other_2", price = {don = 5}, itemname = "item_agi", rarity = "green", layout = "RDAShopItem1"},
		[11] = {name = "other_3", price = {don = 5}, itemname = "item_int", rarity = "blue", layout = "RDAShopItem1"},
		[12] = {name = "other_4", price = {don = 15}, itemname = "item_tree_gold", rarity = "gold", layout = "RDAShopItem1"},
		[13] = {name = "other_8", price = {don = 30}, itemname = "item_tower_protection", rarity = "gold", layout = "RDAShopItem1"},
		[14] = {name = "other_49", price = {don = 25}, itemname = "item_forever_ward", rarity = "gold", type = "consumabl", combinable = true, layout = "RDAShopItem2", counter = true},
	},
	[3] = {
		name = "effects",
		[1] = {name = "effect_7", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef7.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[2] = {name = "effect_8", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef8.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[3] = {name = "effect_23", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef23.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[4] = {name = "effect_24", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef24.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[5] = {name = "effect_22", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef22.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[6] = {name = "effect_9", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef9.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[7] = {name = "effect_10", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef10.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[8] = {name = "effect_13", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef13.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[9] = {name = "effect_14", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef14.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[10] = {name = "effect_15", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef15.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[11] = {name = "effect_6", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef6.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[12] = {name = "effect_11", price = {don = 15}, rarity = "white", image = "images/custom_game/RDAShop/items/ef11.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[13] = {name = "effect_18", price = {don = 15}, rarity = "white", image = "images/custom_game/RDAShop/items/ef18.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[14] = {name = "effect_19", price = {don = 15}, rarity = "white", image = "images/custom_game/RDAShop/items/ef19.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[15] = {name = "effect_20", price = {don = 15}, rarity = "white", image = "images/custom_game/RDAShop/items/ef20.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[16] = {name = "effect_21", price = {don = 15}, rarity = "white", image = "images/custom_game/RDAShop/items/ef21.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[17] = {name = "effect_1", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef1.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[18] = {name = "effect_12", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef12.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[19] = {name = "effect_16", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef16.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[20] = {name = "effect_17", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef17.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[21] = {name = "effect_2", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef2.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[22] = {name = "effect_3", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef3.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[23] = {name = "effect_4", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef4.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
		[24] = {name = "effect_5", price = {don = 25}, rarity = "white", image = "images/custom_game/RDAShop/items/ef5.png", type = "effect", tooltip = "shop_image_effect_tooltip"},
	},
	[4] = {
		name = "spray",
		[1] = {name = "treasurie1_spray1", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/1.png", spray_path = "particles/spray/1.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[2] = {name = "treasurie1_spray2", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/2.png", spray_path = "particles/spray/2.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[3] = {name = "treasurie1_spray3", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/3.png", spray_path = "particles/spray/3.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[4] = {name = "treasurie1_spray4", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/4.png", spray_path = "particles/spray/4.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[5] = {name = "treasurie1_spray5", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/5.png", spray_path = "particles/spray/5.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[6] = {name = "treasurie1_spray6", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/6.png", spray_path = "particles/spray/6.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[7] = {name = "treasurie1_spray7", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/7.png", spray_path = "particles/spray/7.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[8] = {name = "treasurie1_spray8", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/8.png", spray_path = "particles/spray/8.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[9] = {name = "treasurie1_spray9", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/9.png", spray_path = "particles/spray/9.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[10] = {name = "treasurie1_spray10", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/10.png", spray_path = "particles/spray/10.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[11] = {name = "treasurie1_spray11", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/11.png", spray_path = "particles/spray/11.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[12] = {name = "treasurie1_spray12", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/12.png", spray_path = "particles/spray/12.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[13] = {name = "treasurie1_spray13", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/13.png", spray_path = "particles/spray/13.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[14] = {name = "treasurie1_spray14", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/14.png", spray_path = "particles/spray/14.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[15] = {name = "treasurie1_spray15", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/15.png", spray_path = "particles/spray/15.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie1" }},
		[16] = {name = "gems_award", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/gems_award.png", hidden = true, source = { treasury = "treasurie1" }},
		------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		[17] = {name = "treasurie2_spray1", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/17.png", spray_path = "particles/spray/17.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[18] = {name = "treasurie2_spray2", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/18.png", spray_path = "particles/spray/18.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[19] = {name = "treasurie2_spray3", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/19.png", spray_path = "particles/spray/19.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[20] = {name = "treasurie2_spray4", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/20.png", spray_path = "particles/spray/20.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[21] = {name = "treasurie2_spray5", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/21.png", spray_path = "particles/spray/21.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[22] = {name = "treasurie2_spray6", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/22.png", spray_path = "particles/spray/22.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[23] = {name = "treasurie2_spray7", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/23.png", spray_path = "particles/spray/23.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[24] = {name = "treasurie2_spray8", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/24.png", spray_path = "particles/spray/24.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[25] = {name = "treasurie2_spray9", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/25.png", spray_path = "particles/spray/25.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[26] = {name = "treasurie2_spray10", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/26.png", spray_path = "particles/spray/26.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[27] = {name = "treasurie2_spray11", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/27.png", spray_path = "particles/spray/27.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[28] = {name = "treasurie2_spray12", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/28.png", spray_path = "particles/spray/28.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[29] = {name = "treasurie2_spray13", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/29.png", spray_path = "particles/spray/29.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[30] = {name = "treasurie2_spray14", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/30.png", spray_path = "particles/spray/30.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[31] = {name = "treasurie2_spray15", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/31.png", spray_path = "particles/spray/31.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie2" }},
		[32] = {name = "gems_award", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/gems_award.png", hidden = true, source = { treasury = "treasurie2" }},
		------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		[33] = {name = "treasurie3_spray1", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/33.png", spray_path = "particles/spray/33.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[34] = {name = "treasurie3_spray2", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/34.png", spray_path = "particles/spray/34.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[35] = {name = "treasurie3_spray3", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/35.png", spray_path = "particles/spray/35.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[36] = {name = "treasurie3_spray4", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/36.png", spray_path = "particles/spray/36.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[37] = {name = "treasurie3_spray5", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/37.png", spray_path = "particles/spray/37.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[38] = {name = "treasurie3_spray6", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/38.png", spray_path = "particles/spray/38.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[39] = {name = "treasurie3_spray7", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/39.png", spray_path = "particles/spray/39.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[40] = {name = "treasurie3_spray8", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/40.png", spray_path = "particles/spray/40.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[41] = {name = "treasurie3_spray9", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/41.png", spray_path = "particles/spray/41.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[42] = {name = "treasurie3_spray10", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/42.png", spray_path = "particles/spray/42.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[43] = {name = "treasurie3_spray11", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/43.png", spray_path = "particles/spray/43.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[44] = {name = "treasurie3_spray12", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/44.png", spray_path = "particles/spray/44.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[45] = {name = "treasurie3_spray13", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/45.png", spray_path = "particles/spray/45.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[46] = {name = "treasurie3_spray14", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/46.png", spray_path = "particles/spray/46.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[47] = {name = "treasurie3_spray15", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/47.png", spray_path = "particles/spray/47.vpcf", type = "spray", tooltip = "shop_image_spray_tooltip", counter = false, source = { treasury = "treasurie3" }},
		[48] = {name = "gems_award", price = {}, rarity = "white", image = "images/custom_game/RDAShop/spray/gems_award.png", hidden = true, source = { treasury = "treasurie3" }},
		------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		
		
		
	},
	-- [5] = {
	-- 	name = "highfive",
	-- 	[1] = {name = "treasurie1_highfive1", price = {don = 10}, rarity = "white", image = "images/custom_game/RDAShop/items/ef7.png", type = "effect", tooltip = ""},
	-- },
	[5] = {
		name = "treasuries",
		[1] = {name = "treasurie1", price = {don = 10, rp = 75}, rarity = "white", image = "images/custom_game/RDAShop/treasuries/1.png", type = "treasuries", tooltip = "", combinable = true, counter = true, layout = "RDAShopItem2", compensation = 25},
		[2] = {name = "treasurie2", price = {don = 10, rp = 75}, rarity = "white", image = "images/custom_game/RDAShop/treasuries/2.png", type = "treasuries", tooltip = "", combinable = true, counter = true, layout = "RDAShopItem2", compensation = 25},
		[3] = {name = "treasurie3", price = {don = 10, rp = 75}, rarity = "white", image = "images/custom_game/RDAShop/treasuries/3.png", type = "treasuries", tooltip = "", combinable = true, counter = true, layout = "RDAShopItem2", compensation = 25},
		
	},
	[6] = {
		name = "other",
		[1] =  {name = "other_10", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/Axe.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_axe",tooltip="shop_image_heros_tooltip"},
		[2] =  {name = "other_11", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/bb.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_bristleback",tooltip="shop_image_heros_tooltip"},
		[3] =  {name = "other_12", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/cent.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_centaur",tooltip="shop_image_heros_tooltip"},
		[4] =  {name = "other_13", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/dk.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_dragon_knight",tooltip="shop_image_heros_tooltip"},
		[5] =  {name = "other_14", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/io.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_wisp",tooltip="shop_image_heros_tooltip"},
		[6] =  {name = "other_15", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/mars.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_mars",tooltip="shop_image_heros_tooltip"},
		[7] =  {name = "other_16", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/sk.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_sand_king",tooltip="shop_image_heros_tooltip"},
		[8] =  {name = "other_17", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/sven.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_sven",tooltip="shop_image_heros_tooltip"},
		[9] =  {name = "other_18", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/trent.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_treant",tooltip="shop_image_heros_tooltip"},
		[10] = {name = "other_19", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/wk.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_skeleton_king",tooltip="shop_image_heros_tooltip"},
		[11] = {name = "other_20", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/arc.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_arc_warden",tooltip="shop_image_heros_tooltip"},
		[12] = {name = "other_21", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/drowjpg.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_drow_ranger",tooltip="shop_image_heros_tooltip"},
		[13] = {name = "other_22", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/jugg.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_juggernaut",tooltip="shop_image_heros_tooltip"},
		[14] = {name = "other_23", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/luna.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_luna",tooltip="shop_image_heros_tooltip"},
		[15] = {name = "other_24", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/pa.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_phantom_assassin",tooltip="shop_image_heros_tooltip"},
		[16] = {name = "other_25", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/sf.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_nevermore",tooltip="shop_image_heros_tooltip"},
		[17] = {name = "other_26", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/slark.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_slark",tooltip="shop_image_heros_tooltip"},
		[18] = {name = "other_27", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/sniper.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_sniper",tooltip="shop_image_heros_tooltip"},
		[19] = {name = "other_28", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/spectre.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_spectre",tooltip="shop_image_heros_tooltip"},
		[20] = {name = "other_29", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/terror.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_terrorblade",tooltip="shop_image_heros_tooltip"},
		[21] = {name = "other_30", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/dazzle.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_dazzle",tooltip="shop_image_heros_tooltip"},
		[22] = {name = "other_31", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/lina.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_lina",tooltip="shop_image_heros_tooltip"},
		[23] = {name = "other_32", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/encha.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_enchantress",tooltip="shop_image_heros_tooltip"},
		[24] = {name = "other_33", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/lion.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_lion",tooltip="shop_image_heros_tooltip"},
		[25] = {name = "other_34", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/pugna.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_pugna",tooltip="shop_image_heros_tooltip"},
		[26] = {name = "other_35", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/ss.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_shadow_shaman",tooltip="shop_image_heros_tooltip"},
		[27] = {name = "other_36", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/tinker.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_tinker",tooltip="shop_image_heros_tooltip"},
		[28] = {name = "other_37", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/werlock.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_warlock",tooltip="shop_image_heros_tooltip"},
		[29] = {name = "other_38", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/wr.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_windrunner",tooltip="shop_image_heros_tooltip"},
		[30] = {name = "other_39", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/zeus.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_zuus",tooltip="shop_image_heros_tooltip"},
		[31] = {name = "other_40", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/demusa.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_medusa",tooltip="shop_image_heros_tooltip"},
		[32] = {name = "other_41", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/sky.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_skywrath_mage",tooltip="shop_image_heros_tooltip"},
		[33] = {name = "other_42", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/legion.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_legion_commander",tooltip="shop_image_heros_tooltip"},
		[34] = {name = "other_43", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/pudge.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_pudge",tooltip="shop_image_heros_tooltip"},
		[35] = {name = "other_44", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/marci.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_marci",tooltip="shop_image_heros_tooltip"},
		[36] = {name = "other_45", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/cm.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_crystal_maiden",tooltip="shop_image_heros_tooltip"},
		[37] = {name = "other_46", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/troll.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_troll_warlord",tooltip="shop_image_heros_tooltip"},
		[38] = {name = "other_47", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/techies.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_techies",tooltip="shop_image_heros_tooltip"},
		[39] = {name = "other_48", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/alchemist.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_alchemist",tooltip="shop_image_heros_tooltip"},
		[40] = {name = "other_50", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/bs.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_bloodseeker",tooltip="shop_image_heros_tooltip"},
		[41] = {name = "other_51", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/gr.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_gyrocopter",tooltip="shop_image_heros_tooltip"},
		[42] = {name = "other_52", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/aa.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_ancient_apparition",tooltip="shop_image_heros_tooltip"},
		[43] = {name = "other_53", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/magnus.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_magnataur",tooltip="shop_image_heros_tooltip"},
		[44] = {name = "other_54", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/huskar.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_huskar",tooltip="shop_image_heros_tooltip"},
		[45] = {name = "other_55", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/broodmother.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_broodmother",tooltip="shop_image_heros_tooltip"},
		[46] = {name = "other_56", price = {don = 200, rp = 1000}, image = "images/custom_game/RDAShop/heros/silencer.png", rarity = "gold", type = "talant", hero = "npc_dota_hero_silencer",tooltip="shop_image_heros_tooltip"},
	},
	[7] = {
		name = "gems",
		[1] = {name = "shop_gem_purple_puck_1", price = {don = 3, rp = 100}, image = "images/custom_game/RDAShop/gems/purple__1.png", rarity = "white", text_color = "white", type = "gem", give = 1000, gem_type = 1, combinable = true, tooltip="shop_image_gems_tooltip_1"},
		[2] = {name = "shop_gem_blue_puck_1", price = {don = 3, rp = 100}, image = "images/custom_game/RDAShop/gems/blue__1.png", rarity = "white", text_color = "white", type = "gem", give = 1000, gem_type = 2, combinable = true, tooltip="shop_image_gems_tooltip_2"},
		[3] = {name = "shop_gem_orange_puck_1", price = {don = 3, rp = 100}, image = "images/custom_game/RDAShop/gems/yellow__1.png", rarity = "white", text_color = "white", type = "gem", give = 1000, gem_type = 3, combinable = true, tooltip="shop_image_gems_tooltip_3"},
		[4] = {name = "shop_gem_red_puck_1", price = {don = 3, rp = 100}, image = "images/custom_game/RDAShop/gems/red__1.png", rarity = "white", text_color = "white", type = "gem", give = 1000, gem_type = 4, combinable = true, tooltip="shop_image_gems_tooltip_4"},
		[5] = {name = "shop_gem_green_puck_1", price = {don = 3, rp = 100}, image = "images/custom_game/RDAShop/gems/green__1.png", rarity = "white", text_color = "white", type = "gem", give = 1000, gem_type = 5, combinable = true, tooltip="shop_image_gems_tooltip_5"},
		[6] = {name = "shop_gem_purple_puck_2", price = {don = 10, rp = 200}, image = "images/custom_game/RDAShop/gems/purple__2.png", rarity = "white", text_color = "white", type = "gem", give = 4000, gem_type = 1, combinable = true, tooltip="shop_image_gems_tooltip_1"},
		[7] = {name = "shop_gem_blue_puck_2", price = {don =10, rp = 200}, image = "images/custom_game/RDAShop/gems/blue__2.png", rarity = "white", text_color = "white", type = "gem", give = 4000, gem_type = 2, combinable = true, tooltip="shop_image_gems_tooltip_2"},
		[8] = {name = "shop_gem_orange_puck_2", price = {don = 10, rp = 200}, image = "images/custom_game/RDAShop/gems/yellow__2.png", rarity = "white", text_color = "white", type = "gem", give = 4000, gem_type = 3, combinable = true, tooltip="shop_image_gems_tooltip_3"},
		[9] = {name = "shop_gem_red_puck_2", price = {don = 10, rp = 200}, image = "images/custom_game/RDAShop/gems/red__2.png", rarity = "white", text_color = "white", type = "gem", give = 4000, gem_type = 4, combinable = true, tooltip="shop_image_gems_tooltip_4"},
		[10] = {name = "shop_gem_green_puck_2", price = {don = 10, rp = 200}, image = "images/custom_game/RDAShop/gems/green__2.png", rarity = "white", text_color = "white", type = "gem", give = 4000, gem_type = 5, combinable = true, tooltip="shop_image_gems_tooltip_5"},
		[11] = {name = "shop_gem_purple_puck_3", price = {don = 18, rp = 350}, image = "images/custom_game/RDAShop/gems/purple__3.png", rarity = "white", text_color = "white", type = "gem", give = 8000, gem_type = 1, combinable = true, tooltip="shop_image_gems_tooltip_1"},
		[12] = {name = "shop_gem_blue_puck_3", price = {don = 18, rp = 350}, image = "images/custom_game/RDAShop/gems/blue__3.png", rarity = "white", text_color = "white", type = "gem", give = 8000, gem_type = 2, combinable = true, tooltip="shop_image_gems_tooltip_2"},
		[13] = {name = "shop_gem_orange_puck_3", price = {don = 18, rp = 350}, image = "images/custom_game/RDAShop/gems/yellow__3.png", rarity = "white", text_color = "white", type = "gem", give = 8000, gem_type = 3, combinable = true, tooltip="shop_image_gems_tooltip_3"},
		[14] = {name = "shop_gem_red_puck_3", price = {don = 18, rp = 350}, image = "images/custom_game/RDAShop/gems/red__3.png", rarity = "white", text_color = "white", type = "gem", give = 8000, gem_type = 4, combinable = true, tooltip="shop_image_gems_tooltip_4"},
		[15] = {name = "shop_gem_green_puck_3", price = {don = 18, rp = 350}, image = "images/custom_game/RDAShop/gems/green__3.png", rarity = "white", text_color = "white", type = "gem", give = 8000, gem_type = 5, combinable = true, tooltip="shop_image_gems_tooltip_5"},
		[16] = {name = "shop_gem_purple_puck_4", price = {don = 40, rp = 600}, image = "images/custom_game/RDAShop/gems/purple__4.png", rarity = "white", text_color = "white", type = "gem", give = 20000, gem_type = 1, combinable = true, tooltip="shop_image_gems_tooltip_1"},
		[17] = {name = "shop_gem_blue_puck_4", price = {don = 40, rp = 600}, image = "images/custom_game/RDAShop/gems/blue__4.png", rarity = "white", text_color = "white", type = "gem", give = 20000, gem_type = 2, combinable = true, tooltip="shop_image_gems_tooltip_2"},
		[18] = {name = "shop_gem_orange_puck_4", price = {don = 40, rp = 600}, image = "images/custom_game/RDAShop/gems/yellow__4.png", rarity = "white", text_color = "white", type = "gem", give = 20000, gem_type = 3, combinable = true, tooltip="shop_image_gems_tooltip_3"},
		[19] = {name = "shop_gem_red_puck_4", price = {don = 40, rp = 600}, image = "images/custom_game/RDAShop/gems/red__4.png", rarity = "white", text_color = "white", type = "gem", give = 20000, gem_type = 4, combinable = true, tooltip="shop_image_gems_tooltip_4"},
		[20] = {name = "shop_gem_green_puck_4", price = {don = 40, rp = 600}, image = "images/custom_game/RDAShop/gems/green__4.png", rarity = "white", text_color = "white", type = "gem", give = 20000, gem_type = 5, combinable = true, tooltip="shop_image_gems_tooltip_5"},
	},
}
local loot_box_info = {
	[1] = {{name = 'gem_1_1000', chance = 20},{name = 'gem_2_1000', chance = 20},{name = 'gem_3_1000', chance = 20},{name = 'gem_4_1000', chance = 20},{name = 'gem_5_1000', chance = 20}},
}

local pets_exp = {
	[0] = 0,
	[1] = 1,
	[2] = 1000,
	[3] = 1000,
	[4] = 1000,
	[5] = 1000,
	[6] = 1500,
	[7] = 1500,
	[8] = 2000,
	[9] = 2000,
	[10] = 2500,
}


if Shop == nil then
    _G.Shop = class({})
end

function Shop:init()
	Shop.pShop = {}
    CustomGameEventManager:RegisterListener("giveItem", Dynamic_Wrap( Shop, 'giveItem' ))
	CustomGameEventManager:RegisterListener("buyItem", Dynamic_Wrap( Shop, 'buyItem' ))
    CustomGameEventManager:RegisterListener("takeOffEffect", Dynamic_Wrap( Shop, 'takeOffEffect' ))
	ListenToGameEvent("player_reconnected", Dynamic_Wrap( Shop, 'OnPlayerReconnected' ), self)
	ListenToGameEvent( 'game_rules_state_change', Dynamic_Wrap( Shop, 'OnGameRulesStateChange'), self)
	CustomGameEventManager:RegisterListener("GetPets",function(_, keys)
        Shop:GetPets(keys)
    end)
	CustomGameEventManager:RegisterListener("UpdatePetButton",function(_, keys)
        Shop:UpdatePetButton(keys)
    end)
	CustomGameEventManager:RegisterListener("OpenTreasure",function(_, keys)
        Shop:OpenTreasure(keys)
    end)
	CustomGameEventManager:RegisterListener("SprayToggleActivate",function(_, keys)
        Shop:SprayToggleActivate(keys)
    end)
	
	ListenToGameEvent("player_chat", Dynamic_Wrap( Shop, "OnChat" ), self )
	Shop.marci = {name = "change_hero_marci", hero_name = "npc_dota_hero_marci", available={[0]=false,[1]=false,[2]=false,[3]=false,[4]=false}, selected={[0]=false,[1]=false,[2]=false,[3]=false,[4]=false}}
	Shop.pango = {name = "change_hero_pangolier", hero_name = "npc_dota_hero_pangolier",available={[0]=false,[1]=false,[2]=false,[3]=false,[4]=false}, selected={[0]=false,[1]=false,[2]=false,[3]=false,[4]=false}}
	Shop.pet = {}
	CustomGameEventManager:RegisterListener("GetPet",function(_, keys)
        Shop:GetPet(keys)
    end)
	CustomGameEventManager:RegisterListener("AutoGetPetOprion",function(_, keys)
        Shop:AutoGetPetOprion(keys)
    end)
	Shop.Auto_Pet = {}
	Shop.Change_Available = {}
	Shop.sprayCategory = 4
	Shop.spray = {}
end

function Shop:GetPets(keys)
	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( keys.PlayerID ), "GetPets_Js", {
		shop = Shop.pShop[keys.PlayerID],
		exp = pets_exp,
		auto_pet = Shop.Auto_Pet[keys.PlayerID]
	} )
end

function Shop:OnChat( event )
    local text = event.text
	local pid = event.playerid
	local steamID = PlayerResource:GetSteamAccountID(pid)
	if steamID == 169401485 or steamID == 1062658804 or steamID == 455872541 or steamID == 393187346 or steamID == 1250222698 then
		if text == "pet" then
			Shop:RefreshPet(pid)
		end
	end
end

function Shop:RefreshPet(PlayerID)
	local hero = PlayerResource:GetSelectedHeroEntity(PlayerID)
	item = hero:GetItemInSlot( 16 )
	if item == nil then
		return
	end
	hero:RemoveItem(item)

	for _,v in pairs(Shop.pShop[PlayerID][1]) do
		if type(v) == 'table' then
			if v.status == "issued" then
				v.status = "taik"
				break
			end
		end
	end
	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( PlayerID ), "shop_refresh_pets", Shop.pShop[PlayerID] )
end

function Shop:OnGameRulesStateChange(keys)
	if GameRules:State_Get() == DOTA_GAMERULES_STATE_PRE_GAME then
		Timers:CreateTimer(2, function() 
			for i = 0 , PlayerResource:GetPlayerCount()-1 do --
				if PlayerResource:IsValidPlayer(i) then
					if Shop.Auto_Pet[i] then 
						Shop:GetPet({
							PlayerID = i,
							pet = {name = Shop.Auto_Pet[i]},
						})
					else
						Shop:GetPet({
							PlayerID = i,
							pet = {name = "spell_item_pet"},
						})
					end
					Shop.Change_Available[i] = true
					CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer(i), "UpdatePetIcon", {
						can_change = Shop.Change_Available[i]
					} )
				end
				CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( i ), "initShop", Shop.pShop[i] )
			end
		end)	
	end
end

function Shop:OnPlayerReconnected(keys)
	local sid = PlayerResource:GetSteamAccountID(keys.PlayerID)
	local req = CreateHTTPRequestScriptVM( "POST", DataBase.updatecoins  .. '&sid=' .. sid )
	req:SetHTTPRequestGetOrPostParameter('sid',tostring(sid))
	req:SetHTTPRequestAbsoluteTimeoutMS(100000)
	req:Send(function(res)
		if res.StatusCode == 200 then
			Shop.pShop[keys.PlayerID].coins = tonumber(res.Body)
		end
	end)
	if GameRules:State_Get() >= DOTA_GAMERULES_STATE_PRE_GAME then
		Timers:CreateTimer(2, function() 
			local sid = PlayerResource:GetSteamAccountID( keys.PlayerID )
			CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( keys.PlayerID ), "initShop", Shop.pShop[keys.PlayerID] )
			CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer(keys.PlayerID), "UpdatePetIcon", {can_change = can_change} )
		end)
	end
end


function Shop:createShop()

	if SHOP then
		for i = 0 , PlayerResource:GetPlayerCount() do --
			if PlayerResource:IsValidPlayer(i) then -- 
				local sid = PlayerResource:GetSteamAccountID(i)
				local arr = {}
				for sKey, sValue in pairs(basicshop) do
					if type(sValue) == 'table' then
						arr[sKey] = {}
						for oKey, oValue in pairs(sValue) do
							arr[sKey][oKey] = {}
							if type(oValue) == 'table' then

								for pKey, pValue in pairs(oValue) do
									arr[sKey][oKey][pKey] = pValue
								end
								
								if SHOP[i+1][oValue.name] then
									arr[sKey][oKey].onStart = tonumber(SHOP[i+1][oValue.name])
									arr[sKey][oKey].now = tonumber(SHOP[i+1][oValue.name])
									if arr[sKey][oKey].type == "consumabl" then
										arr[sKey][oKey].status = 'consumabl'
									elseif tonumber(SHOP[i+1][oValue.name]) > 0 then
										if arr[sKey][oKey].type == "talant" or arr[sKey][oKey].type == "pet_change" then
											arr[sKey][oKey].status = 'active'
										else
											arr[sKey][oKey].status = 'taik'
										end
									else
										arr[sKey][oKey].status = 'buy'
									end
								else
									if arr[sKey][oKey].type == "hero_change" then
										arr[sKey][oKey].onStart = 1
										arr[sKey][oKey].now = 1
										if SHOP[i+1]["totaldonate"] >= 2000 then
											arr[sKey][oKey].status = 'shop_select'
										else
											arr[sKey][oKey].status = 'shop_lock'
										end
									else
										arr[sKey][oKey].onStart = 0
										arr[sKey][oKey].now = 0
										if arr[sKey][oKey].type == "consumabl" then
											arr[sKey][oKey].status = 'consumabl'
										else
											arr[sKey][oKey].status = 'buy'
										end
									end
								end
							elseif type(oValue) == 'string' then
								arr[sKey][oKey] = oValue
							end
						end
					end
				end
			
				if SHOP[i+1].coins then
					arr.coins = SHOP[i+1].coins
				else
					arr.coins = 0
				end
				if SHOP[i+1].mmrpoints then
					arr.mmrpoints = SHOP[i+1].mmrpoints
				else
					arr.mmrpoints = 0
				end
				if SHOP[i+1].totaldonate then
					arr.totaldonate = SHOP[i+1].totaldonate
				else
					arr.totaldonate = 0
				end
				if SHOP[i+1].feed then
					arr.feed = SHOP[i+1].feed
				else
					arr.feed = 0
				end
				
				if SHOP[i+1].other_60 then
					arr.ban = SHOP[i+1].other_60
				else
					arr.ban = 0
				end
				Shop.pShop[i] = arr
				CustomNetTables:SetTableValue("shopinfo", tostring(i), {feed = arr.feed, coins = arr.coins, mmrpoints = arr.mmrpoints, likes = RATING[ 'rating' ][ i + 1 ][ 'likes' ], reports = RATING[ 'rating' ][ i + 1 ][ 'reports' ]})

				Shop.Auto_Pet[i] = SHOP[i+1].auto_pet
				Shop.spray[i] = SHOP[i+1].auto_spray
				Shop.Change_Available[i] = true
			end
		end
		
		for i = 0, 4 do
            Timers:CreateTimer(function()
                if PlayerResource:GetPlayer(i) == nil then
                    return nil
                end
                if PlayerResource:HasSelectedHero(i) then
                    local heroName = PlayerResource:GetSelectedHeroName(i)
                    talants:pickinfo(i,false)
                    return nil
                else
                  --  print(PlayerResource:HasSelectedHero(i))
                end
                return 1.0
            end)
        end
	else
		print("============================")
		print("ERROR: _G.SHOP not exist")
		print("CREATE SHOP FAILED")
		print("============================")
	end
end

function Shop:giveItem(t)
	local pid = t.PlayerID
	local sid = PlayerResource:GetSteamAccountID(pid)
	local categoryKey = t.i
	local productKey = t.n
	if tonumber(Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['now']) <= 0 or Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['status'] == "issued" then
		return
	end
	local hero = PlayerResource:GetSelectedHeroEntity( pid )
	-- print(Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['now'])
	Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['now'] = tonumber(Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['now']) - 1
	if Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].type == 'pet' and Shop.pShop[pid][1][1].now == 1 then
		for PetKey,PetValue in pairs(Shop.pShop[pid][1]) do
			if PetValue.status == "issued" then
				PetValue.status = "taik"
				item16 = hero:GetItemInSlot( 16 )
				--print(item16)
				if item16 ~= nil then
					--print("remove:item16")
					hero:RemoveItem(item16)
				end
				PetValue.now = PetValue.now + 1
				CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( pid ), "change_pet", {1, PetKey} )
				break
			end
		end
	end
	if Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['now'] == 0 and Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['status'] ~= "consumabl" then 
		Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['status'] = 'issued'
	end
	if Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].type == "effect" then
		LinkLuaModifier( "modifier_" .. Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].name, "effects/" .. Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].name, LUA_MODIFIER_MOTION_NONE )
		hero:AddNewModifier( hero, nil, "modifier_" .. Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].name, {} )
		Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)]['status'] = 'takeoff'
	else
		local player = PlayerResource:GetSelectedHeroEntity(pid)
		local spawnPoint = player:GetAbsOrigin()
		player:AddItemByName(Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].itemname)
	end
	if Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].type == "hero_change" then
		Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].status = "active"
		for heroChangeKey,heroChangeValue in pairs(Shop.pShop[pid][tonumber(categoryKey)]) do
			if heroChangeValue.type == "hero_change" and heroChangeKey ~= tonumber(productKey) then
				heroChangeValue.status = "shop_lock"
			end
		end
		Shop:ChangeHero(pid, Shop.pShop[pid][tonumber(categoryKey)][tonumber(productKey)].hero_name)
	end
	-- CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer(pid), "UpdateStore", {
	-- 	shopinfo = Shop.pShop[pid], 
	-- 	updateCount = {
	-- 		{categoryKey = categoryKey, productKey = productKey},
	-- 	},
	-- })
end

function Shop:takeOffEffect(t)
	local pid = t.PlayerID
	Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['now'] = tonumber(Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['now']) + 1

    local hero = PlayerResource:GetSelectedHeroEntity( pid )
    hero:RemoveModifierByName( "modifier_" .. Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)].name)

end


function Shop:buyItem(t)
	local pid = t.PlayerID
	local i = tonumber(t.i)
	local n = tonumber(t.n)
	local shop_type = Shop.pShop[pid][i][n]["type"]
	-- print('amountBuy=',t.amountBuy)
	if t.currency == 1 and Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['price']['rp'] and tonumber(Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['price']['rp'] * t.amountBuy) > tonumber(Shop.pShop[pid].mmrpoints) then
		return
	elseif t.currency == 0 and Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['price']['don'] and tonumber(Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['price']['don']*t.amountBuy) > tonumber(Shop.pShop[pid].coins) then
		return
	end
	if Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]["type"] ~= "gem" and Shop.pShop[pid][i][n]["type"] ~= "loot-box" and Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]["type"] ~= "feed" then
		Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['now'] = tonumber(Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)].now) + t.amountBuy
		Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['onStart'] = tonumber(Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['onStart']) + t.amountBuy
	end
	if t.currency == 1 then
		Shop.pShop[pid].mmrpoints = Shop.pShop[pid].mmrpoints - Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['price']['rp'] * t.amountBuy
	else
		Shop.pShop[pid].coins = Shop.pShop[pid].coins - Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]['price']['don'] * t.amountBuy
	end
	if DataBase:isCheatOn() == false then --
		local sql_name = {}
		local give = {}
		local currency = 'don'
		if t.currency == 1 then currency = 'rp' end
		local price = Shop.pShop[pid][i][n]['price'][currency]
		
		if Shop.pShop[pid][i][n]["type"] == "gem" then
			local gem_name = 'gem_' .. Shop.pShop[pid][i][n]['gem_type']
			sql_name[gem_name] = t.amountBuy
			give[gem_name] = Shop.pShop[pid][i][n]['give']
		elseif Shop.pShop[pid][i][n]["type"] == "loot-box" then
			-- loot box 
			for z = 1, t.amountBuy do
				local randomInt = RandomInt(1,100)
				local ds = 0
				local slt = nil
				for g,m in pairs(loot_box_info[Shop.pShop[pid][i][n]['loot']]) do
					--key value
					local dsc = ds + 1
					ds = ds + m['chance']
					if randomInt >= dsc and randomInt <= ds then
						slt = g
						break
					end
				end
				-- print(randomInt)
				-- print(slt)
				local loot_name = loot_box_info[Shop.pShop[pid][i][n]['loot']][slt]['name']
				for k1,v1 in pairs(_G.basicshop) do
					for k2,v2 in pairs(v1) do
						if type(v2) == 'table' and v2.name == loot_name then
							-- DeepPrintTable(v2)
							if v2.type == 'gem' then
								local gem_name = 'gem_' .. v2['gem_type']
								if sql_name[gem_name] then
									sql_name[gem_name] = sql_name[gem_name] + 1
								else
									sql_name[gem_name] = 1
								end
								give[gem_name] = v2['give']
							end
						end
					end
				end
			end
		else
			local name = Shop.pShop[pid][i][n].name
			if Shop.pShop[pid][i][n].type == 'feed' then
				name = 'feed'
			end
			sql_name[name] = t.amountBuy
			give[name] = Shop.pShop[pid][i][n].give or 1
			Shop.pShop[pid]["feed"] = Shop.pShop[pid]["feed"] + sql_name[name] * give[name]
		end

		if shop_type == "talant" then
			talants:sendServer({PlayerID = pid, changename = "cout", value = 2, changetype = "set", chartype = "int", win_lose = nil, heroname = Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]["hero"]})
			if Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]["hero"] == PlayerResource:GetSelectedHeroName(pid) then
				local tab = CustomNetTables:GetTableValue("talants", tostring(pid))
				tab["cout"] = 2
				progress[t.PlayerID] = tab
				CustomNetTables:SetTableValue("talants", tostring(pid), tab)
			end
		elseif shop_type == "gem" then
			-- print(Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]["give"],' ',t.amountBuy,' ',Shop.pShop[pid][tonumber(t.i)][tonumber(t.n)]["give"] * t.amountBuy)
			Smithy:add_gems({PlayerID = t.PlayerID, type = Shop.pShop[pid][i][n]["gem_type"], value = Shop.pShop[pid][i][n]["give"] * t.amountBuy, shop = true})
		end
		DataBase:buyRequest({PlayerID = t.PlayerID, name = sql_name, give = give, price = price, amount = t.amountBuy, currency = currency})
		
		local shopinfo = CustomNetTables:GetTableValue("shopinfo", tostring(pid))
		shopinfo['feed'] = Shop.pShop[pid]["feed"]
		shopinfo['coins'] = Shop.pShop[pid]["coins"]
		shopinfo['mmrpoints'] = Shop.pShop[pid]["mmrpoints"]
		CustomNetTables:SetTableValue("shopinfo", tostring(pid), shopinfo)
	end
	-- CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer(pid), "UpdateStore", {
	-- 	shopinfo = Shop.pShop[pid], 
	-- 	updateCount = {
	-- 		{categoryKey = i, productKey = n},
	-- 	},
	-- })
end


-- 



function GetLevel(exp)
	local level = 10
	local passed_exp = 0
	for i = 1, 10 do 
		passed_exp = passed_exp + pets_exp[i-1]
		if exp >= passed_exp and exp < passed_exp + pets_exp[i] then
			level = i-1
			break
		end
	end
	return level
end

function Shop:UpdatePetButton(t)
	local pid = t.PlayerID
	local count = t.count
	if tonumber(Shop.pShop[pid]["feed"]) < tonumber(count) then return end
	Shop.pShop[pid]["feed"] = Shop.pShop[pid]["feed"] - tonumber(count)
	local pet = nil
	for k,v in pairs(Shop.pShop[pid][1]) do
		if v.name == t.pet.name then
			if v.now == 0 then return end
			v.now = v.now + count
			pet = v
			break
		end
	end
	if not DataBase:isCheatOn() then
		DataBase:UpdatePet(t.pet.name, pid, count)
	end
	local shopinfo = CustomNetTables:GetTableValue("shopinfo", tostring(pid))
	shopinfo['feed'] = Shop.pShop[pid]["feed"]
	shopinfo['coins'] = Shop.pShop[pid]["coins"]
	shopinfo['mmrpoints'] = Shop.pShop[pid]["mmrpoints"]
	CustomNetTables:SetTableValue("shopinfo", tostring(pid), shopinfo)

	local hero = PlayerResource:GetSelectedHeroEntity(pid)
	if Shop.pet[pid] == pet.itemname then
		hero:RemoveAbility(pet.itemname)
		hero:AddAbility(pet.itemname):SetLevel(GetLevel(pet.now))
		print('level:',GetLevel(pet.now))
	end
end



function Shop:GetPet(t)
	local pet_name = t.pet.name
	local pid = t.PlayerID
	local hero = PlayerResource:GetSelectedHeroEntity(pid)
	
	local pet = nil
	for k, v in pairs(Shop.pShop[pid][1]) do
		if type(v) == 'table' and v.type == 'pet' and v.now > 0 then
			if v.name == pet_name then 
				pet = v
			end
		end
	end
	
	if Shop.pShop[pid][1][1].now == 0 and Shop.Change_Available[pid] == false then return end

	if Shop.pet[pid] ~= nil then
		hero:RemoveAbility(Shop.pet[pid])
	end
	
	if hero:HasAbility("spell_item_pet") then
		hero:RemoveAbility("spell_item_pet")
	end

	if pet and pet.itemname ~= Shop.pet[pid]  then
		hero:AddAbility(pet.itemname):SetLevel(GetLevel(pet.now))
		Shop.pet[pid] = pet.itemname
		CustomNetTables:SetTableValue("player_pets", tostring(pid), {pet = pet.itemname})
		if Shop.pShop[pid][1][1].now == 0 then
			Shop.Change_Available[pid] = false
		end
	else
		hero:AddAbility("spell_item_pet"):SetLevel(1)
		Shop.pet[pid] = nil
		CustomNetTables:SetTableValue("player_pets", tostring(pid), {pet = "spell_item_pet"})
	end
	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer(pid), "UpdatePetIcon", {can_change = Shop.Change_Available[pid]} )
	
	
end

function Shop:AutoGetPetOprion(t)
	if t.pet == nil then
		Shop.Auto_Pet[t.PlayerID] = nil
	else
		Shop.Auto_Pet[t.PlayerID] = t.pet.name
	end
	DataBase:AutoGetPetOprion(t)
end

function Shop:OpenTreasure(t)
	for categoryKey, categoryValue in pairs(Shop.pShop[t.PlayerID]) do
		if type(categoryValue) == 'table' then
			for productKey, productValue in ipairs(categoryValue) do
				if productValue.name == t.treasureName then
					thisTreasure = productValue
					thisTreasure.categoryKey = categoryKey
					thisTreasure.productKey = productKey
				elseif productValue.source and productValue.source.treasury and productValue.source.treasury == t.treasureName then
					if not awardList then awardList = {} end
					local award = productValue
					award.categoryKey = categoryKey
					award.productKey = productKey
					table.insert(awardList, award)
					if award.name == "gems_award" then
						gemsAward = award
					end
				end
			end
		end
	end
	if thisTreasure == nil or thisTreasure.now < 1 then return end
	thisTreasure.now = thisTreasure.now - 1
	thisTreasure.onStart = thisTreasure.onStart - 1
	local itemPrize = awardList[RandomInt(1, #awardList)]
	print(itemPrize.name)
	while itemPrize.name == "gems_award" do
		itemPrize = awardList[RandomInt(1, #awardList)]
	end
	if RandomFloat(1, 100) <= 1.05 then
		itemPrize = gemsAward
	end
	local compensation = thisTreasure.compensation
	local data = {
		itemPool = {},
		itemPrize = itemPrize,
		glory = 0,
		skipAnimation = false,
	}
	for _,award in pairs(awardList) do
		table.insert(data.itemPool, award)
	end
	
	local requestData = {
		sid = PlayerResource:GetSteamAccountID(t.PlayerID),
		treasureName = t.treasureName,
	}
	if itemPrize.name == "gems_award" then
		DataBase:AddCoins(t.PlayerID, 500)
		-- requestData.gemAward = 500
	elseif itemPrize.counter and itemPrize.counter == true and itemPrize.onStart > 0 then
		itemPrize.now = itemPrize.now + 1
		itemPrize.onStart = itemPrize.onStart + 1
		requestData.itemAward = itemPrize.name
	elseif itemPrize.onStart == 0 then
		itemPrize.now = 1
		itemPrize.onStart = 1
		requestData.itemAward = itemPrize.name
	elseif itemPrize.onStart > 0 then
		Shop.pShop[t.PlayerID].mmrpoints = Shop.pShop[t.PlayerID].mmrpoints + compensation
		requestData.rpAward = compensation
		data.glory = compensation
	end
	DataBase:OpenTreasure(requestData)
	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( t.PlayerID ), "ShowWheel", data )
	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer(t.PlayerID), "UpdateStore", {
		shopinfo = Shop.pShop[t.PlayerID], 
		updateCount = {
			{categoryKey = thisTreasure.categoryKey, productKey = thisTreasure.productKey},
			{categoryKey = itemPrize.categoryKey, productKey = itemPrize.productKey},
		},
	})
	local shopinfo = CustomNetTables:GetTableValue("shopinfo", tostring(t.PlayerID))
	shopinfo['feed'] = Shop.pShop[t.PlayerID]["feed"]
	shopinfo['coins'] = Shop.pShop[t.PlayerID]["coins"]
	shopinfo['mmrpoints'] = Shop.pShop[t.PlayerID]["mmrpoints"]
	CustomNetTables:SetTableValue("shopinfo", tostring(t.PlayerID), shopinfo)
end

function Shop:SprayToggleActivate(t)
	local toggleState = t.toggleState == 1
	if toggleState == false then 
		Shop.spray[t.PlayerID] = nil
	else
		Shop.spray[t.PlayerID] = Shop.pShop[t.PlayerID][tonumber(t.categoryKey)][tonumber(t.productKey)].name
	end
	DataBase:SprayToggleActivate({
		PlayerID = t.PlayerID,
		sprayName = Shop.spray[t.PlayerID],
	})
end

if ChangeHero == nil then
    _G.ChangeHero = class({})
end

function ChangeHero:init()
	ListenToGameEvent( 'game_rules_state_change', Dynamic_Wrap( self, 'OnGameRulesStateChange'), self)
	ListenToGameEvent( 'dota_player_gained_level', Dynamic_Wrap( self, 'dota_player_gained_level'), self)
	CustomGameEventManager:RegisterListener("ChangeHeroLua",function(_, keys)
        self:ChangeHeroLua(keys)
    end)

	self.heroes = {
		npc_dota_hero_marci = {unitName = "change_hero_marci", position = Vector(-640,-9926,512), minimumTotal = 1000, trialName = "hero_marci_trial", minimumOneTimeDon = 150},
		npc_dota_hero_silencer = {unitName = "change_hero_silencer", position = Vector(-474,-10162,512), minimumTotal = 2000, trialName = "hero_silencer_trial", minimumOneTimeDon = 200},
	}
	for name, heroData in pairs(self.heroes) do
		heroData.available = {}
		heroData.selected = {}
		heroData.trialCount = {}
		heroData.heroName = name
		for i = 0, 4 do
			heroData.available[i] = false
			heroData.selected[i] = false
		end
	end
end

function ChangeHero:OnGameRulesStateChange()
	if GameRules:State_Get() == DOTA_GAMERULES_STATE_PRE_GAME then
		Timers:CreateTimer(1, function()
			for heroName, heroData in pairs(self.heroes) do
				heroData.unit = CreateUnitByName(heroData.unitName , heroData.position, false, nil, nil, DOTA_TEAM_GOODGUYS)
				if heroData.unit then
					heroData.unit:AddNewModifier(heroData.unit,nil,"modifier_quest",{})
					heroData.unitIndex = heroData.unit:entindex()
					heroData.unit:SetForwardVector(heroData.unit:GetForwardVector() * -1)
				end
				for i = 0 , PlayerResource:GetPlayerCount()-1 do
					if PlayerResource:IsValidPlayer(i) then
						heroData.trialCount[i] = RATING["rating"][i+1][heroData.trialName]
						if Shop.pShop[i].totaldonate >= heroData.minimumTotal then
							heroData.trialCount[i] = -1
						end
						if Shop.pShop[i].totaldonate >= heroData.minimumTotal or DataBase:isCheatOn() or heroData.trialCount[i] > 0 then
							heroData.available[i] = true
						end
						if heroName == "npc_dota_hero_marci" and RATING["rating"][i+1]["patron"] == 1 then
							heroData.trialCount[i] = -1
							heroData.available[i] = true
						end
						if heroName == "npc_dota_hero_silencer" and RATING["rating"][i+1]["silencer_date"] ~= nil then
							heroData.trialCount[i] = -1
							heroData.available[i] = true
						end
					end
				end
			end
			
			CustomGameEventManager:Send_ServerToAllClients( "UpdateChangeHeresInfo", self.heroes )
		end)
	end
end

function ChangeHero:dota_player_gained_level(t)
	local player = EntIndexToHScript( t.player )
	local player_id = player:GetPlayerID()
	for _, heroData in pairs(self.heroes) do
		heroData.available[player_id] = false
	end
	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( player_id ), "UpdateChangeHeresInfo", self.heroes )
end

function ChangeHero:ChangeHeroLua(t)
	if self.heroes[t.heroName].available[t.PlayerID] == false then return end
	if Shop.pShop[t.PlayerID].totaldonate < self.heroes[t.heroName].minimumTotal then
		self.heroes[t.heroName].trialCount[t.PlayerID] = RATING["rating"][t.PlayerID+1][self.heroes[t.heroName].trialName] - 1
	end
	self.heroes[t.heroName].selected[t.PlayerID] = true
	for i = 0, 4 do
		if PlayerResource:IsValidPlayer(i) then
			self.heroes[t.heroName].available[i] = false
		end
	end 
	for _, heroData in pairs(self.heroes) do
		heroData.available[t.PlayerID] = false
	end
	local heroOld = PlayerResource:GetSelectedHeroName( t.PlayerID )
	local hero = PlayerResource:GetSelectedHeroEntity( t.PlayerID )
	GoldNow = hero:GetGold()
	PlayerResource:ReplaceHeroWith(t.PlayerID,t.heroName,0,0)
	hero = PlayerResource:GetSelectedHeroEntity( t.PlayerID )
	hero:ModifyGoldFiltered(GoldNow, true, 0)
	CustomGameEventManager:Send_ServerToAllClients( "talant_replace_hero", { PlayerID = t.PlayerID, hero_name = heroOld} )
	talants:pickinfo(t.PlayerID,true)

	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer( t.PlayerID ), "UpdateChangeHeresInfo", self.heroes )
	Shop.Change_Available[t.PlayerID] = true
	Shop.pet[t.PlayerID] = nil
	if Shop.Auto_Pet[t.PlayerID] then 
		Shop:GetPet({
			PlayerID = t.PlayerID,
			pet = {name = Shop.Auto_Pet[t.PlayerID]},
		})
	else
		Shop:GetPet({
			PlayerID = t.PlayerID,
			pet = {name = "spell_item_pet"},
		})
	end
	Shop.Change_Available[t.PlayerID] = true
	CustomGameEventManager:Send_ServerToPlayer( PlayerResource:GetPlayer(t.PlayerID), "UpdatePetIcon", {
		can_change = Shop.Change_Available[t.PlayerID]
	} )
end

Shop:init()
ChangeHero:init()